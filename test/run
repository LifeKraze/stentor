#!/usr/bin/env node
var fs           = require('fs')
  , spawn        = require('child_process').spawn;

process.env.NODE_ENV = 'test';

var app = spawn('node', ['app', '-e', 'test', '-w', '2']);

process.on('SIGINT', exit);
process.on('SIGTERM', exit);
process.on('exit', exit);
app.stdout.pipe(process.stdout);
app.stderr.pipe(process.stderr);

function exit(code) {
  app.kill();
  process.exit(code);
}

setTimeout(function() {
  var mocha = spawn('mocha', ['-R', 'spec'], {stdio: 'inherit'});
  mocha.on('SIGINT', exit);
  mocha.on('SIGTERM', exit);
  mocha.on('exit', exit);
}, 1000);
